<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ToMoreBeyond - é¢ç™½ã„ã“ã¨ã ã‘ã‚’ã™ã‚‹ã€‚å‹ã¨å…±ã«é“ãªãé“ã‚’è¶Šãˆã‚‹</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  
  <style>
    /* ãƒªã‚»ãƒƒãƒˆCSS */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    /* åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
    body {
      font-family: 'Share Tech Mono', monospace;
      overflow: hidden;
      position: relative;
      height: 100vh;
      background: #ffffff;
    }
    
    /* èƒŒæ™¯å‹•ç”»ã‚³ãƒ³ãƒ†ãƒŠ */
    .video-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    }
    
    .video-background video {
      position: absolute;
      top: 50%;
      left: 50%;
      min-width: 100%;
      min-height: 100%;
      width: auto;
      height: auto;
      transform: translate(-50%, -50%);
      object-fit: cover;
    }
    
    /* å‹•ç”»ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    .video-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.3);
      pointer-events: none;
      z-index: 1;
    }
    
    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ©ãƒƒãƒ‘ãƒ¼ */
    .content-wrapper {
      position: relative;
      z-index: 1;
      width: 100%;
      height: 100vh;
      overflow: hidden;
    }
    
    /* ãƒ­ã‚´ */
    .logo {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
      font-family: 'Orbitron', monospace;
      font-size: 24px;
      font-weight: 700;
      color: #fff;
      text-decoration: none;
      letter-spacing: 2px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }
    
    /* ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ */
    .game-area {
      position: relative;
      width: 100%;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠ */
    .cards-container {
      position: relative;
      width: 100%;
      height: 400px;
      overflow: hidden;
      padding: 0 50px;
    }
    
    .cards-track {
      display: flex;
      gap: 24px;
      transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      padding: 0 50px;
    }
    
    /* ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
    .card {
      min-width: 280px;
      height: 360px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 4px solid #000;
      border-radius: 16px;
      padding: 32px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    .card:hover {
      transform: translateY(-10px) scale(1.02);
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    }
    
    .card-icon {
      font-size: 48px;
      margin-bottom: 20px;
      color: #000;
    }
    
    .card-title {
      font-family: 'Orbitron', monospace;
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 12px;
      color: #000;
    }
    
    .card-description {
      font-size: 14px;
      color: #666;
      line-height: 1.5;
    }
    
    /* 8bit ãƒ‰ãƒƒãƒˆçµµé¢¨æ£’äººé–“ï¼ˆå…ƒã®ã‚µã‚¤ã‚ºï¼‰ */
    .tiny-character {
      position: fixed;
      bottom: max(80px, calc(env(safe-area-inset-bottom) + 70px));
      left: 20px;
      transform: translateZ(0);
      width: 80px;
      height: 80px;
      z-index: 800;
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
      contain: layout style paint;
      will-change: transform, left;
      backface-visibility: hidden;
      transition: left 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 1s ease;
      opacity: 1;
      cursor: pointer;
    }
    
    /* ã‚¸ãƒ£ãƒ³ãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    .tiny-character.jumping {
      animation: jumpAnimation 0.6s ease;
    }
    
    @keyframes jumpAnimation {
      0% {
        transform: translateY(0) scaleX(1) scaleY(1);
      }
      20% {
        transform: translateY(-5px) scaleX(1.1) scaleY(0.9);
      }
      50% {
        transform: translateY(-80px) scaleX(0.95) scaleY(1.05);
      }
      80% {
        transform: translateY(-5px) scaleX(1.05) scaleY(0.95);
      }
      100% {
        transform: translateY(0) scaleX(1) scaleY(1);
      }
    }
    
    /* æœ€å¤§ãƒ¬ãƒ™ãƒ«é”æˆæ™‚ã®èµ¤è‰²è¡¨ç¤º */
    .tiny-character.max-level-achieved .pixel {
      background: #dc3545 !important;
      box-shadow: 1px 1px 0 rgba(220, 53, 69, 0.3), 0 0 4px #dc3545;
    }
    
    .tiny-character.max-level-achieved {
      filter: drop-shadow(0 0 8px rgba(220, 53, 69, 0.6));
      animation: maxLevelGlow 2s ease-in-out infinite;
    }
    
    @keyframes maxLevelGlow {
      0%, 100% {
        filter: drop-shadow(0 0 8px rgba(220, 53, 69, 0.6));
      }
      50% {
        filter: drop-shadow(0 0 16px rgba(220, 53, 69, 0.9));
      }
    }
    
    /* ã‚¹ã‚¿ãƒ¼çŠ¶æ…‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆãƒãƒªã‚ªã®ã‚ˆã†ãªç„¡æ•µçŠ¶æ…‹ï¼‰ */
    @keyframes starEffect {
      0% {
        transform: scale(1) rotate(0deg);
        filter: hue-rotate(0deg) brightness(1.2) saturate(1.5);
      }
      25% {
        transform: scale(1.1) rotate(90deg);
        filter: hue-rotate(90deg) brightness(1.5) saturate(2);
      }
      50% {
        transform: scale(1) rotate(180deg);
        filter: hue-rotate(180deg) brightness(1.8) saturate(2.5);
      }
      75% {
        transform: scale(1.1) rotate(270deg);
        filter: hue-rotate(270deg) brightness(1.5) saturate(2);
      }
      100% {
        transform: scale(1) rotate(360deg);
        filter: hue-rotate(360deg) brightness(1.2) saturate(1.5);
      }
    }
    
    /* ãƒ”ã‚¯ã‚»ãƒ«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”¨ã‚°ãƒªãƒƒãƒ‰ */
    .pixel-character {
      position: relative;
      width: 100%;
      height: 100%;
    }
    
    .pixel-grid {
      position: relative;
      width: 100%;
      height: 100%;
      transform: scale(5);
      transform-origin: top left;
    }
    
    /* å€‹åˆ¥ãƒ”ã‚¯ã‚»ãƒ« */
    .pixel {
      position: absolute;
      background: #000;
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }
    
    /* GIFé¢¨ã‚³ãƒé€ã‚Šæ­©è¡Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    .walking-animation-container {
      position: relative;
      width: 100%;
      height: 100%;
    }
    
    /* æ­©è¡Œãƒ•ãƒ¬ãƒ¼ãƒ  */
    .walk-frame {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0;
      transition: opacity 0.1s ease;
    }
    
    .walk-frame.active {
      opacity: 1;
    }
    
    /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®æ­©è¡ŒçŠ¶æ…‹ã§ã®ãƒ•ãƒ¬ãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆ */
    .tiny-character.walking .walk-frame.idle {
      opacity: 0;
    }
    
    /* ãƒ¬ãƒ™ãƒ«è¡¨ç¤º */
    .level-display {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      padding: 16px 24px;
      border-radius: 8px;
      color: #fff;
      font-family: 'Orbitron', monospace;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }
    
    .level-text {
      font-size: 14px;
      margin-bottom: 8px;
    }
    
    .exp-bar {
      width: 200px;
      height: 8px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .exp-fill {
      height: 100%;
      background: linear-gradient(90deg, #00ff00, #00cc00);
      transition: width 0.3s ease;
      width: 0%;
    }
    
    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
    @media (max-width: 768px) {
      .logo {
        font-size: 18px;
      }
      
      .card {
        min-width: 240px;
        height: 320px;
        padding: 24px;
      }
      
      .card-icon {
        font-size: 40px;
      }
      
      .card-title {
        font-size: 18px;
      }
      
      .character-container {
        bottom: 60px;
        left: 30px;
      }
      
      .character {
        width: 50px;
        height: 70px;
      }
    }
    
    /* ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    /* ä½ã‚¹ãƒšãƒƒã‚¯ãƒ‡ãƒã‚¤ã‚¹å‘ã‘æœ€é©åŒ– */
    .low-performance-mode .video-container video {
      display: none;
    }
    
    .low-performance-mode .video-overlay {
      background: linear-gradient(135deg, #1a1a1a 0%, #000 100%);
    }
    
    .low-performance-mode .card {
      backdrop-filter: none;
      -webkit-backdrop-filter: none;
      background: rgba(255, 255, 255, 0.98);
      transition: transform 0.2s ease !important;
    }
    
    .low-performance-mode .character-container {
      transition: left 0.3s linear !important;
    }
    
    /* GPUã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æœ€é©åŒ– */
    .cards-track {
      will-change: transform;
      transform: translateZ(0);
    }
    
    .character-container {
      will-change: left;
      transform: translateZ(0);
    }
    
    .card {
      will-change: transform;
      transform: translateZ(0);
    }
    
    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰ */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s ease;
    }
    
    .loading-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }
    
    .loading-text {
      color: #fff;
      font-size: 18px;
      font-family: 'Orbitron', monospace;
    }
  </style>
</head>
<body>
  <!-- èƒŒæ™¯å‹•ç”» -->
  <div class="video-background" id="videoBackground">
    <video id="backgroundVideo" autoplay muted loop playsinline preload="auto">
      <source src="Timeline 1.mp4" type="video/mp4">
    </video>
    <div class="video-overlay"></div>
  </div>
  
  <!-- å‹•ç”»çŠ¶æ…‹è¡¨ç¤º -->
  <div id="videoStatus" style="position: fixed; top: 20px; right: 20px; z-index: 9999; background: rgba(0,0,0,0.85); color: #00ff00; padding: 12px 16px; border-radius: 8px; font-family: 'Share Tech Mono', monospace; font-size: 12px; max-width: 250px; word-wrap: break-word; border: 2px solid rgba(0,255,0,0.3); backdrop-filter: blur(5px); transition: opacity 0.3s ease;">
    ğŸ”„ å‹•ç”»èª­ã¿è¾¼ã¿ä¸­...
  </div>
  
  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="content-wrapper">
    <!-- ãƒ­ã‚´ -->
    <a href="/" class="logo">ToMoreBeyond</a>
    
    <!-- ãƒ¬ãƒ™ãƒ«è¡¨ç¤º -->
    <div class="level-display">
      <div class="level-text">Level <span id="currentLevel">1</span></div>
      <div class="exp-bar">
        <div class="exp-fill" id="expFill"></div>
      </div>
    </div>
    
    <!-- ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
    <div class="game-area">
      <div class="cards-container">
        <div class="cards-track" id="cardsTrack">
          <!-- ã‚«ãƒ¼ãƒ‰ã¯å‹•çš„ã«ç”Ÿæˆ -->
        </div>
      </div>
    </div>
    
    <!-- 8bit ãƒ‰ãƒƒãƒˆçµµé¢¨æ­©è¡Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ£’äººé–“ -->
    <div class="tiny-character" id="tinyCharacter" role="img" aria-label="æ­©è¡Œä¸­ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼">
      <div class="walking-animation-container">
        
        <!-- ã‚¢ã‚¤ãƒ‰ãƒ«ãƒ•ãƒ¬ãƒ¼ãƒ : ã‚·ãƒ³ãƒ—ãƒ«ãªæ£’äººé–“ -->
        <div class="walk-frame idle pixel-character active">
          <div class="pixel-grid">
            <!-- é ­éƒ¨ (3x3ã®å››è§’) -->
            <div class="pixel" style="top: 1px; left: 6px; width: 3px; height: 3px;"></div>
            
            <!-- èƒ´ä½“ (ç¸¦ç·š 4ãƒ”ã‚¯ã‚»ãƒ«) -->
            <div class="pixel" style="top: 4px; left: 7px; width: 1px; height: 4px;"></div>
            
            <!-- å·¦è…• (æ°´å¹³ç·š) -->
            <div class="pixel" style="top: 5px; left: 4px; width: 3px; height: 1px;"></div>
            
            <!-- å³è…• (æ°´å¹³ç·š) -->
            <div class="pixel" style="top: 5px; left: 8px; width: 3px; height: 1px;"></div>
            
            <!-- å·¦è„š (æ–œã‚ä¸‹) -->
            <div class="pixel" style="top: 8px; left: 6px; width: 1px; height: 3px;"></div>
            
            <!-- å³è„š (æ–œã‚ä¸‹) -->
            <div class="pixel" style="top: 8px; left: 8px; width: 1px; height: 3px;"></div>
          </div>
        </div>
        
        <!-- ãƒ•ãƒ¬ãƒ¼ãƒ 1: æ­©è¡Œãƒãƒ¼ã‚ºï¼ˆå·¦è„šå‰é€²ï¼‰ -->
        <div class="walk-frame frame1 pixel-character">
          <div class="pixel-grid">
            <!-- é ­éƒ¨ (3x3ã®å››è§’) -->
            <div class="pixel" style="top: 1px; left: 6px; width: 3px; height: 3px;"></div>
            
            <!-- èƒ´ä½“ (ç¸¦ç·š 4ãƒ”ã‚¯ã‚»ãƒ«) -->
            <div class="pixel" style="top: 4px; left: 7px; width: 1px; height: 4px;"></div>
            
            <!-- å·¦è…• (ä¸Šå‘ã) -->
            <div class="pixel" style="top: 4px; left: 5px; width: 2px; height: 1px;"></div>
            <div class="pixel" style="top: 3px; left: 5px; width: 1px; height: 1px;"></div>
            
            <!-- å³è…• (ä¸‹å‘ã) -->
            <div class="pixel" style="top: 6px; left: 8px; width: 2px; height: 1px;"></div>
            <div class="pixel" style="top: 7px; left: 9px; width: 1px; height: 1px;"></div>
            
            <!-- å·¦è„š (å‰é€²) -->
            <div class="pixel" style="top: 8px; left: 5px; width: 1px; height: 2px;"></div>
            <div class="pixel" style="top: 10px; left: 4px; width: 1px; height: 1px;"></div>
            
            <!-- å³è„š (å¾Œæ–¹) -->
            <div class="pixel" style="top: 8px; left: 8px; width: 1px; height: 2px;"></div>
            <div class="pixel" style="top: 10px; left: 9px; width: 1px; height: 1px;"></div>
          </div>
        </div>
        
        <!-- ãƒ•ãƒ¬ãƒ¼ãƒ 2: æ­©è¡Œãƒãƒ¼ã‚ºï¼ˆå³è„šå‰é€²ï¼‰ -->
        <div class="walk-frame frame2 pixel-character">
          <div class="pixel-grid">
            <!-- é ­éƒ¨ (3x3ã®å››è§’) -->
            <div class="pixel" style="top: 1px; left: 6px; width: 3px; height: 3px;"></div>
            
            <!-- èƒ´ä½“ (ç¸¦ç·š 4ãƒ”ã‚¯ã‚»ãƒ«) -->
            <div class="pixel" style="top: 4px; left: 7px; width: 1px; height: 4px;"></div>
            
            <!-- å·¦è…• (ä¸‹å‘ã) -->
            <div class="pixel" style="top: 6px; left: 5px; width: 2px; height: 1px;"></div>
            <div class="pixel" style="top: 7px; left: 4px; width: 1px; height: 1px;"></div>
            
            <!-- å³è…• (ä¸Šå‘ã) -->
            <div class="pixel" style="top: 4px; left: 8px; width: 2px; height: 1px;"></div>
            <div class="pixel" style="top: 3px; left: 9px; width: 1px; height: 1px;"></div>
            
            <!-- å·¦è„š (å¾Œæ–¹) -->
            <div class="pixel" style="top: 8px; left: 6px; width: 1px; height: 2px;"></div>
            <div class="pixel" style="top: 10px; left: 5px; width: 1px; height: 1px;"></div>
            
            <!-- å³è„š (å‰é€²) -->
            <div class="pixel" style="top: 8px; left: 8px; width: 1px; height: 2px;"></div>
            <div class="pixel" style="top: 10px; left: 9px; width: 1px; height: 1px;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-text">Loading...</div>
  </div>
  
  <script>
    // ã‚²ãƒ¼ãƒ ã‚¯ãƒ©ã‚¹
    class MinimalSite {
      constructor() {
        this.cards = [
          { icon: '[]', title: 'ä¼šç¤¾æ¦‚è¦', description: 'MICHI NAKI MICHI WO KIRU', link: 'detail/company.html' },
          { icon: 'X', title: 'ãƒŸãƒƒã‚·ãƒ§ãƒ³', description: 'OMOSHIROI KOTO DAKE WO SURU', link: 'detail/mission.html' },
          { icon: '+', title: 'TADATAKA', description: 'IDOU GA SONO MAMA NIKKI NI', link: 'pages/tadataka.html' },
          { icon: 'T', title: 'TOIRUN', description: 'IMA SUGU TOIRE WO SAITAN DE', link: 'pages/toirun.html' },
          { icon: 'M', title: 'MEET IN THE MIDDLE', description: 'SAITEKI NA SHUUGOU CHITEN WO', link: 'pages/meetinthemiddle.html' },
          { icon: 'Y', title: 'å±±ç”°', description: 'CDO / DESIGNER', link: 'detail/yamada.html' },
          { icon: 'M', title: 'æ­£ç•™', description: 'CEO / ENGINEER', link: 'detail/masatome.html' },
          { icon: 'A', title: 'å®‰è—¤', description: 'ARTIST', link: 'detail/ando.html' },
          { icon: 'B', title: 'ãƒ–ãƒ­ã‚°', description: 'KAIHATSU NO URA BANASHI', link: 'detail/blog.html' },
          { icon: 'V', title: 'å‹•ç”»', description: 'PRODUCT SHOUKAI', link: 'detail/video.html' },
          { icon: 'S', title: 'SNS', description: 'HIBI NO HASSHIN', link: 'detail/sns.html' },
          { icon: '@', title: 'ãŠå•ã„åˆã‚ã›', description: 'OKI GARU NI DOUZO', link: 'detail/contact.html' }
        ];
        
        this.currentLevel = 1;
        this.currentExp = 0;
        this.maxExp = 100;
        this.characterPosition = 0;
        this.viewedCards = new Set();
        
        // ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–ã®ãŸã‚ã®è¨­å®š
        this.isLowEndDevice = this.detectLowEndDevice();
        this.lastUpdateTime = 0;
        this.rafId = null;
        this.eventListeners = [];
        this.walkFrameInterval = null;
        
        this.init();
      }
      
      detectLowEndDevice() {
        // ãƒ¡ãƒ¢ãƒªåˆ¶é™ã®ãƒã‚§ãƒƒã‚¯
        if ('deviceMemory' in navigator && navigator.deviceMemory < 2) {
          return true;
        }
        
        // CPUã‚³ã‚¢æ•°ã®ãƒã‚§ãƒƒã‚¯
        if ('hardwareConcurrency' in navigator && navigator.hardwareConcurrency <= 2) {
          return true;
        }
        
        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€Ÿåº¦ã®ãƒã‚§ãƒƒã‚¯
        if ('connection' in navigator) {
          const connection = navigator.connection;
          if (connection.saveData || connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g') {
            return true;
          }
        }
        
        return false;
      }
      
      init() {
        // ä½ã‚¹ãƒšãƒƒã‚¯ãƒ‡ãƒã‚¤ã‚¹ã®å ´åˆã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã‚’é©ç”¨
        if (this.isLowEndDevice) {
          document.body.classList.add('low-performance-mode');
        }
        
        // ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
        this.createCards();
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        this.setupEventListeners();
        
        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        this.setupCharacterEvents();
        
        // èƒŒæ™¯å‹•ç”»åˆæœŸåŒ–
        this.initializeBackgroundVideo();
        
        // ãƒ¡ãƒ¢ãƒªç›£è¦–ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        this.setupMemoryMonitoring();
        
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’èª­ã¿è¾¼ã¿
        this.loadGameState();
        
        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’è¡¨ç¤º
        this.showCharacter();
        
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†
        this.hideLoading();
      }
      
      showCharacter() {
        const character = document.getElementById('tinyCharacter');
        if (character) {
          character.style.opacity = '1';
          // åˆæœŸä½ç½®ã‚’è¨­å®š
          character.style.left = '20px';
          // æœ€åˆã®ã‚«ãƒ¼ãƒ‰ä½ç½®ã‚’æ›´æ–°
          this.updatePositions();
          
          setTimeout(() => {
            character.style.transition = 'left 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
          }, 100);
        }
      }
      
      setupMemoryMonitoring() {
        // ãƒ¡ãƒ¢ãƒªç›£è¦–ï¼ˆä½ã‚¹ãƒšãƒƒã‚¯ãƒ‡ãƒã‚¤ã‚¹ã®ã¿ï¼‰
        if (this.isLowEndDevice && 'performance' in window && 'memory' in performance) {
          setInterval(() => {
            const memoryInfo = performance.memory;
            const memoryUsageRatio = memoryInfo.usedJSHeapSize / memoryInfo.jsHeapSizeLimit;
            
            if (memoryUsageRatio > 0.8) {
              this.emergencyCleanup();
            }
          }, 30000); // 30ç§’ã”ã¨ã«ãƒã‚§ãƒƒã‚¯
        }
      }
      
      emergencyCleanup() {
        // ç·Šæ€¥ãƒ¡ãƒ¢ãƒªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        console.warn('âš ï¸ ãƒ¡ãƒ¢ãƒªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Ÿè¡Œ');
        
        // ä¸è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
        this.viewedCards.clear();
        
        // å‹•ç”»ã‚’ä¸€æ™‚åœæ­¢
        const video = document.getElementById('bgVideo');
        if (video) {
          video.pause();
        }
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åœæ­¢
        if (this.rafId) {
          cancelAnimationFrame(this.rafId);
          this.rafId = null;
        }
      }
      
      createCards() {
        const track = document.getElementById('cardsTrack');
        
        this.cards.forEach((card, index) => {
          const cardEl = document.createElement('div');
          cardEl.className = 'card';
          cardEl.dataset.index = index;
          cardEl.innerHTML = `
            <div class="card-icon">${card.icon}</div>
            <h3 class="card-title">${card.title}</h3>
            <p class="card-description">${card.description}</p>
          `;
          
          // ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°ãƒšãƒ¼ã‚¸ã«é·ç§» + ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—
          cardEl.addEventListener('click', () => {
            this.onCardClick(index);
            this.navigateToDetail(card, index);
          });
          
          track.appendChild(cardEl);
        });
      }
      
      setupEventListeners() {
        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        const wheelHandler = this.throttle((e) => {
          e.preventDefault();
          this.handleScroll(e.deltaY);
        }, 16); // 60fps
        
        const keyHandler = (e) => {
          if (e.key === 'ArrowRight') {
            this.moveCharacter(0.05);
          } else if (e.key === 'ArrowLeft') {
            this.moveCharacter(-0.05);
          } else if (e.key === ' ') {
            e.preventDefault();
            this.jump();
          }
        };
        
        // ã‚¿ãƒƒãƒæ“ä½œï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰- æ”¹å–„ç‰ˆ
        let touchStartX = 0;
        let isTouching = false;
        
        const touchStartHandler = (e) => {
          touchStartX = e.touches[0].clientX;
          isTouching = true;
        };
        
        const touchMoveHandler = this.throttle((e) => {
          if (!isTouching) return;
          e.preventDefault();
          
          const touchX = e.touches[0].clientX;
          const diff = touchStartX - touchX;
          const sensitivity = 0.01; // ãƒ¢ãƒã‚¤ãƒ«ç”¨ã®æ„Ÿåº¦èª¿æ•´
          
          this.handleScroll(diff * sensitivity * 100);
          touchStartX = touchX;
        }, 16);
        
        const touchEndHandler = () => {
          isTouching = false;
        };
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²
        document.addEventListener('wheel', wheelHandler, { passive: false });
        document.addEventListener('keydown', keyHandler);
        document.addEventListener('touchstart', touchStartHandler, { passive: true });
        document.addEventListener('touchmove', touchMoveHandler, { passive: false });
        document.addEventListener('touchend', touchEndHandler, { passive: true });
        
        // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ç”¨ã«ä¿å­˜
        this.eventListeners.push(
          { element: document, type: 'wheel', handler: wheelHandler },
          { element: document, type: 'keydown', handler: keyHandler },
          { element: document, type: 'touchstart', handler: touchStartHandler },
          { element: document, type: 'touchmove', handler: touchMoveHandler },
          { element: document, type: 'touchend', handler: touchEndHandler }
        );
      }
      
      setupCharacterEvents() {
        const character = document.getElementById('tinyCharacter');
        if (character) {
          const jumpHandler = () => this.jump();
          character.addEventListener('click', jumpHandler);
          character.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              this.jump();
            }
          });
          
          this.eventListeners.push(
            { element: character, type: 'click', handler: jumpHandler }
          );
        }
      }
      
      throttle(func, limit) {
        let inThrottle;
        return function() {
          const args = arguments;
          const context = this;
          if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
          }
        };
      }
      
      initializeBackgroundVideo() {
        const video = document.getElementById('backgroundVideo');
        const videoStatus = document.getElementById('videoStatus');
        
        if (!video) return;
        
        // å‹•ç”»ã®åŸºæœ¬è¨­å®šã‚’ç¢ºå®Ÿã«è¡Œã†
        video.muted = true;
        video.loop = true;
        video.playsInline = true;
        video.autoplay = true;
        
        // å‹•ç”»ã®èª­ã¿è¾¼ã¿å®Œäº†ã‚’å¾…ã¤
        video.addEventListener('loadeddata', () => {
          video.play().then(() => {
            if (videoStatus) {
              videoStatus.textContent = 'ğŸ¥ å‹•ç”»å†ç”Ÿä¸­';
            }
          }).catch(() => {
            if (videoStatus) {
              videoStatus.textContent = 'ğŸ¯ ã‚¯ãƒªãƒƒã‚¯ã§å†ç”Ÿ';
            }
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã§å†ç”Ÿã‚’è©¦ã¿ã‚‹
            document.addEventListener('click', () => {
              video.play();
            }, { once: true });
          });
        });
        
        // å‹•ç”»ãŒå†ç”Ÿé–‹å§‹ã—ãŸã‚‰çŠ¶æ…‹è¡¨ç¤ºã‚’éš ã™
        video.addEventListener('playing', () => {
          if (videoStatus) {
            setTimeout(() => {
              videoStatus.style.opacity = '0';
              setTimeout(() => videoStatus.style.display = 'none', 500);
            }, 1000);
          }
        });
        
        // å‹•ç”»ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        video.addEventListener('error', () => {
          if (videoStatus) {
            videoStatus.textContent = 'âŒ å‹•ç”»èª­ã¿è¾¼ã¿å¤±æ•—';
          }
        });
        
        // å³åº§ã«èª­ã¿è¾¼ã¿é–‹å§‹
        video.load();
      }
      
      hideLoading() {
        setTimeout(() => {
          const loadingOverlay = document.getElementById('loadingOverlay');
          loadingOverlay.classList.add('hidden');
          
          setTimeout(() => {
            loadingOverlay.style.display = 'none';
          }, 500);
        }, 1000);
      }
      
      handleScroll(deltaY) {
        // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é‡ã‚’ä½ç½®ã«å¤‰æ›ï¼ˆå¿«é©ãªæ„Ÿåº¦ï¼‰
        const sensitivity = 0.003; // ã‚ˆã‚Šåå¿œçš„ãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ„Ÿåº¦
        const scrollAmount = deltaY * sensitivity;
        this.moveCharacter(scrollAmount);
        
        // æ­©è¡Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹
        this.startWalkingAnimation();
        
        // æ­©è¡Œåœæ­¢ã‚¿ã‚¤ãƒãƒ¼
        clearTimeout(this.walkingTimeout);
        this.walkingTimeout = setTimeout(() => {
          this.stopWalkingAnimation();
        }, 200);
      }
      
      startWalkingAnimation() {
        const character = document.getElementById('tinyCharacter');
        if (character) {
          character.classList.add('walking');
          this.animateWalkFrames();
        }
      }
      
      stopWalkingAnimation() {
        const character = document.getElementById('tinyCharacter');
        if (character) {
          character.classList.remove('walking');
          this.stopWalkFrames();
        }
      }
      
      animateWalkFrames() {
        if (this.walkFrameInterval) return;
        
        const frames = document.querySelectorAll('.walk-frame');
        let currentFrame = 0;
        
        this.walkFrameInterval = setInterval(() => {
          frames.forEach(frame => frame.classList.remove('active'));
          frames[currentFrame].classList.add('active');
          currentFrame = (currentFrame + 1) % frames.length;
        }, 200);
      }
      
      stopWalkFrames() {
        if (this.walkFrameInterval) {
          clearInterval(this.walkFrameInterval);
          this.walkFrameInterval = null;
        }
        
        const frames = document.querySelectorAll('.walk-frame');
        frames.forEach(frame => frame.classList.remove('active'));
        frames[0].classList.add('active'); // Reset to first frame
      }
      
      moveCharacter(amount) {
        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä½ç½®ã‚’æ›´æ–°ï¼ˆ0ã€œ1ã®ç¯„å›²ï¼‰
        this.characterPosition = Math.max(0, Math.min(1, this.characterPosition + amount));
        
        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¨ã‚«ãƒ¼ãƒ‰ã‚’ç§»å‹•
        this.updatePositions();
      }
      
      updatePositions() {
        // RAFã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
        if (this.rafId) {
          cancelAnimationFrame(this.rafId);
        }
        
        this.rafId = requestAnimationFrame(() => {
          const character = document.getElementById('tinyCharacter');
          const track = document.getElementById('cardsTrack');
          const screenWidth = window.innerWidth;
          
          if (!character || !track) return;
          
          // ã‚¹ãƒ ãƒ¼ã‚ºãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä½ç½®è¨ˆç®—
          const basePosition = 20; // å·¦ç«¯ã‹ã‚‰ã®åŸºæœ¬ä½ç½®
          const fixedPosition = Math.min(screenWidth * 0.2, 200); // å›ºå®šä½ç½®ï¼ˆç”»é¢å¹…ã®20%ã¾ãŸã¯200pxï¼‰
          
          let charX;
          if (this.characterPosition <= 0.1) {
            // é–‹å§‹æ™‚ï¼šå·¦ç«¯ã‹ã‚‰å¾ã€…ã«ç§»å‹•
            charX = basePosition + (fixedPosition - basePosition) * (this.characterPosition / 0.1);
          } else if (this.characterPosition >= 0.9) {
            // çµ‚äº†æ™‚ï¼šå³ç«¯ã¸ç§»å‹•
            const endPosition = screenWidth - 120;
            charX = fixedPosition + (endPosition - fixedPosition) * ((this.characterPosition - 0.9) / 0.1);
          } else {
            // ä¸­é–“ï¼šå›ºå®šä½ç½®ã‚’ç¶­æŒ
            charX = fixedPosition;
          }
          
          character.style.left = charX + 'px';
          
          // æ”¹å–„ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨ˆç®—
          const cardWidth = 280 + 24; // ã‚«ãƒ¼ãƒ‰å¹… + ãƒãƒ¼ã‚¸ãƒ³
          const totalCardsWidth = cardWidth * this.cards.length;
          const visibleWidth = screenWidth - charX - 150; // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä½ç½®ã‹ã‚‰å³ç«¯ã¾ã§ã®è¡¨ç¤ºå¯èƒ½å¹…
          const maxScrollDistance = Math.max(0, totalCardsWidth - visibleWidth);
          
          // ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
          const scrollX = -maxScrollDistance * this.characterPosition;
          track.style.transform = `translateX(${scrollX}px) translateZ(0)`;
          
          // ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
          const currentCardIndex = Math.round(this.characterPosition * (this.cards.length - 1));
          this.highlightCard(currentCardIndex);
        });
      }
      
      highlightCard(index) {
        const cards = document.querySelectorAll('.card');
        cards.forEach((card, i) => {
          if (i === index) {
            card.style.transform = 'translateY(-5px) scale(1.02)';
            card.style.boxShadow = '0 20px 40px rgba(0,0,0,0.4)';
          } else {
            card.style.transform = '';
            card.style.boxShadow = '';
          }
        });
      }
      
      onCardClick(index) {
        if (!this.viewedCards.has(index)) {
          this.viewedCards.add(index);
          this.gainExp(10);
          // ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ã‚²ãƒ¼ãƒ çŠ¶æ…‹ä¿å­˜
          this.saveGameState();
        }
      }
      
      gainExp(amount) {
        this.currentExp += amount;
        
        if (this.currentExp >= this.maxExp) {
          this.levelUp();
        }
        
        this.updateUI();
      }
      
      levelUp() {
        this.currentLevel++;
        this.currentExp = 0;
        
        // 8bitãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        const character = document.getElementById('tinyCharacter');
        if (character) {
          character.classList.add('level-up');
          setTimeout(() => {
            character.classList.remove('level-up');
          }, 2000);
        }
        
        // æœ€å¤§ãƒ¬ãƒ™ãƒ«æ™‚ã¯èµ¤è‰² + ã‚¹ã‚¿ãƒ¼çŠ¶æ…‹
        if (this.currentLevel >= this.cards.length) {
          setTimeout(() => {
            this.activateMaxLevelEffect();
          }, 2000);
        }
        
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ä¿å­˜
        this.saveGameState();
      }
      
      updateUI() {
        const levelEl = document.getElementById('currentLevel');
        const expFill = document.getElementById('expFill');
        
        levelEl.textContent = this.currentLevel;
        expFill.style.width = (this.currentExp / this.maxExp * 100) + '%';
      }
      
      jump() {
        const character = document.getElementById('tinyCharacter');
        if (character && !character.classList.contains('jumping')) {
          character.classList.add('jumping');
          
          setTimeout(() => {
            character.classList.remove('jumping');
          }, 600);
        }
      }
      
      navigateToDetail(card, index) {
        // ãƒ¬ãƒ™ãƒ«ã¨ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ä¿å­˜
        this.saveGameState();
        
        // è©³ç´°ãƒšãƒ¼ã‚¸ã«é·ç§»ï¼ˆãƒ¬ãƒ™ãƒ«ä¿æŒãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»˜ãï¼‰
        if (card.link) {
          const currentUrl = new URL(card.link, window.location.href);
          currentUrl.searchParams.set('level', this.currentLevel);
          currentUrl.searchParams.set('from', 'main');
          currentUrl.searchParams.set('cardIndex', index);
          
          window.location.href = currentUrl.toString();
        }
      }
      
      saveGameState() {
        const gameState = {
          currentLevel: this.currentLevel,
          currentExp: this.currentExp,
          characterPosition: this.characterPosition,
          viewedCards: Array.from(this.viewedCards),
          timestamp: Date.now()
        };
        
        localStorage.setItem('tomorebeyond_game_state', JSON.stringify(gameState));
      }
      
      loadGameState() {
        try {
          const saved = localStorage.getItem('tomorebeyond_game_state');
          if (saved) {
            const gameState = JSON.parse(saved);
            
            this.currentLevel = gameState.currentLevel || 1;
            this.currentExp = gameState.currentExp || 0;
            this.characterPosition = gameState.characterPosition || 0;
            this.viewedCards = new Set(gameState.viewedCards || []);
            
            // UIæ›´æ–°
            this.updateUI();
            this.updatePositions();
            
            // æœ€å¤§ãƒ¬ãƒ™ãƒ«æ™‚ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨
            if (this.currentLevel >= this.cards.length) {
              this.activateMaxLevelEffect();
            }
          }
        } catch (error) {
          console.error('ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', error);
        }
      }
      
      activateMaxLevelEffect() {
        const character = document.getElementById('tinyCharacter');
        if (character) {
          character.classList.add('max-level-achieved');
          // ã‚¹ã‚¿ãƒ¼çŠ¶æ…‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
          character.style.animation = 'starEffect 0.5s ease-in-out infinite alternate';
        }
      }
      
      cleanup() {
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        this.eventListeners.forEach(({ element, type, handler }) => {
          element.removeEventListener(type, handler);
        });
        this.eventListeners = [];
        
        // RAFã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        if (this.rafId) {
          cancelAnimationFrame(this.rafId);
          this.rafId = null;
        }
        
        // æ­©è¡Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        this.stopWalkFrames();
        
        // å‹•ç”»ã‚’åœæ­¢
        const video = document.getElementById('backgroundVideo');
        if (video) {
          video.pause();
          video.src = '';
        }
        
        // ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
        this.viewedCards.clear();
        this.cards = null;
        
        console.log('ğŸ§¹ ã‚²ãƒ¼ãƒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
      }
    }
    
    // ã‚²ãƒ¼ãƒ é–‹å§‹
    document.addEventListener('DOMContentLoaded', () => {
      window.gameInstance = new MinimalSite();
      
      // å‹•ç”»ã®è‡ªå‹•å†ç”Ÿã‚’å³åº§ã«è©¦è¡Œ
      const video = document.getElementById('backgroundVideo');
      if (video) {
        // ã™ã§ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯å³åº§ã«å†ç”Ÿ
        if (video.readyState >= 3) {
          video.play().catch(() => {});
        }
        // ã¾ã ã®å ´åˆã¯canplayã‚¤ãƒ™ãƒ³ãƒˆã§å†ç”Ÿ
        video.addEventListener('canplay', () => {
          video.play().catch(() => {});
        }, { once: true });
      }
    });
    
    // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    window.addEventListener('beforeunload', () => {
      if (window.gameInstance) {
        window.gameInstance.cleanup();
      }
    });
    
    // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã®ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–
    document.addEventListener('visibilitychange', () => {
      if (window.gameInstance) {
        const video = document.getElementById('backgroundVideo');
        if (document.hidden) {
          // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‹•ç”»ã‚’ä¸€æ™‚åœæ­¢
          if (video) video.pause();
        } else {
          // ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‹•ç”»ã‚’å†é–‹
          if (video && !window.gameInstance.isLowEndDevice) {
            video.play().catch(() => {});
          }
        }
      }
    });
  </script>
</body>
</html>